# 提示词写法梳理

本文档梳理了 RedInk 项目中所有提示词（Prompt）的写法和使用方式。

## 提示词文件位置

所有提示词模板文件位于 `backend/prompts/` 目录下：

- `outline_prompt.txt` - 大纲生成提示词
- `image_prompt.txt` - 图片生成提示词（完整版）
- `image_prompt_short.txt` - 图片生成提示词（短版）

## 1. 大纲生成提示词 (`outline_prompt.txt`)

### 用途
用于生成小红书风格的图文内容大纲。

### 占位符
- `{topic}` - 用户输入的主题/要求

### 使用方式
在 `backend/services/outline.py` 中：

```python
prompt = self.prompt_template.format(topic=topic)
```

### 提示词结构
1. **角色定义**：明确 AI 的角色（小红书内容创作专家）
2. **用户输入**：通过 `{topic}` 占位符接收用户要求
3. **输出要求**：
   - 页数控制（6-12页，可放宽到2-18页）
   - 第一页必须是封面
   - 语言风格要求
   - 内容要求（简洁有力、实用价值）
4. **输出格式**：
   - 使用 `<page>` 标签分割每一页
   - 每页第一行标注类型：`[封面]`、`[内容]`、`[总结]`
   - 避免使用竖线符号 `|`
5. **示例输出**：提供完整的示例展示格式要求
6. **特别提醒**：要求直接输出大纲，不要有对话式回应

### 特殊处理
如果用户提供了参考图片，会在提示词末尾追加：
```python
prompt += f"\n\n注意：用户提供了 {len(images)} 张参考图片，请在生成大纲时考虑这些图片的内容和风格。"
```

## 2. 图片生成提示词 - 完整版 (`image_prompt.txt`)

### 用途
用于生成小红书风格的图文内容图片，包含完整的设计要求和上下文信息。

### 占位符
- `{page_content}` - 当前页面的内容描述
- `{page_type}` - 页面类型（封面/内容/总结）
- `{full_outline}` - 完整的内容大纲（用于保持风格一致性）
- `{user_topic}` - 用户原始需求（用于保持意图一致）

### 使用方式
在 `backend/services/image.py` 中：

```python
prompt = self.prompt_template.format(
    page_content=page_content,
    page_type=page_type,
    full_outline=full_outline,
    user_topic=user_topic if user_topic else "未提供"
)
```

### 提示词结构
1. **任务说明**：生成小红书风格的图文内容图片
2. **合规要求**：
   - 不要带有小红书 logo
   - 去掉参考图片中的水印和 logo
3. **页面信息**：
   - `{page_content}` - 当前页面内容
   - `{page_type}` - 页面类型
   - 非封面页需要参考封面样式
4. **设计要求**（详细）：
   - 整体风格（小红书爆款、清新精致）
   - 文字排版（清晰可读、重要信息突出）
   - 视觉元素（背景简洁、配色和谐）
   - 页面类型特殊要求（封面/内容/总结各有不同）
   - 技术规格（竖版 3:4 比例、高清画质）
5. **风格一致性**：
   - 参考完整大纲确定整体色调和风格
   - `{user_topic}` - 用户原始需求
   - `{full_outline}` - 完整内容大纲
6. **输出要求**：直接给出图片，不要边框或留边

## 3. 图片生成提示词 - 短版 (`image_prompt_short.txt`)

### 用途
简化版的图片生成提示词，适用于某些图片生成服务商（如某些 API 对 prompt 长度有限制）。

### 占位符
- `{page_content}` - 当前页面的内容描述
- `{page_type}` - 页面类型

### 使用方式
在 `backend/services/image.py` 中，当配置了 `short_prompt: true` 时使用：

```python
if self.use_short_prompt and self.prompt_template_short:
    prompt = self.prompt_template_short.format(
        page_content=page_content,
        page_type=page_type
    )
```

### 提示词结构
非常简洁，只包含：
- 基本任务说明（生成小红书风格竖版图片）
- 页面类型和内容
- 基本要求（清新精致、文字清晰、排版美观）

## 提示词使用流程

### 大纲生成流程
1. 用户输入主题 → `topic`
2. 加载 `outline_prompt.txt` 模板
3. 使用 `template.format(topic=topic)` 填充占位符
4. 如果有参考图片，追加图片说明
5. 调用文本生成 API 生成大纲
6. 解析返回的大纲文本（按 `<page>` 分割）

### 图片生成流程
1. 遍历大纲中的每一页
2. 根据配置选择使用完整版或短版提示词
3. 填充占位符：
   - `page_content` - 从大纲解析的页面内容
   - `page_type` - 从大纲解析的页面类型
   - `full_outline` - 完整大纲文本（仅完整版）
   - `user_topic` - 用户原始输入（仅完整版）
4. 调用图片生成 API
5. 保存生成的图片

## 占位符规范

### 命名规范
- 使用小写字母和下划线：`page_content`、`page_type`
- 语义清晰：`user_topic` 表示用户主题，`full_outline` 表示完整大纲

### 必填与可选
- **大纲提示词**：`{topic}` 为必填
- **图片提示词（完整版）**：所有占位符都有默认值处理
  - `user_topic` 如果为空则使用 "未提供"
- **图片提示词（短版）**：所有占位符为必填

## 提示词优化建议

### 1. 结构化
- 使用清晰的章节划分（用数字、标题等）
- 重要要求用特殊标记（如 `【合规特别注意的】`）

### 2. 示例驱动
- 提供完整的示例输出（如 `outline_prompt.txt` 中的示例）
- 示例要覆盖各种场景

### 3. 约束明确
- 明确输出格式要求（如使用 `<page>` 标签）
- 明确禁止事项（如不要使用竖线符号）

### 4. 上下文传递
- 完整版图片提示词通过 `full_outline` 和 `user_topic` 传递上下文
- 确保风格一致性

### 5. 灵活性
- 提供短版和完整版两种选择
- 根据服务商特性选择合适的版本

## 配置控制

### 短版提示词启用
在 `image_providers.yaml` 中配置：

```yaml
providers:
  some_provider:
    type: image_api
    short_prompt: true  # 启用短版提示词
```

### 提示词模板加载
- 模板文件在服务初始化时加载
- 支持运行时动态切换（通过重新初始化服务）

## 注意事项

1. **占位符格式**：必须使用 Python 的 `{variable}` 格式，不能使用其他模板语法
2. **编码**：所有提示词文件使用 UTF-8 编码
3. **换行处理**：提示词中的换行会被保留，注意格式控制
4. **特殊字符**：避免在提示词内容中使用可能与解析冲突的字符（如 `|`）
5. **长度限制**：某些 API 对 prompt 长度有限制，需要时使用短版

